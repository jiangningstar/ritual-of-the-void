# elasticsearch 基础性能优化设置(持续更新)

> 容量


        我们项目初期应该搭建一个怎么样的集群, cpu, 内存, 磁盘是否ssd, 一共需要多少节点等, 这些是根据我      

        们要应对的数据目标来进行规划的, 所以我们在集群搭建初期要确定我们的目标数据量进行容量测试, 反推我

        们需要搭建集群的规模. (基于压力测试)


> es集群各个节点不与业务功能复用一台机子


        es非常占用内存, 如果与业务复用一台机子, 很有可能出现内存不足的问题

> 磁盘选择SSD

        我们的业务对检索和写入都有一定的要求, 所以为了这些要求, 磁盘必须选择SSD

> java jvm内存堆配置

        官方的设置建议是 Min(32GB, 机器内存大小/2)

        这里仅仅测试过机子内存/2的情况, 看过很多文档, 都建议不要设置极限值, 热数据设置(26G), 冷数据(31G)

> cpu 核数不要太小

        一般的有可能不关注CPU核数, 但是我们是对写入和检索有一定要求, es会有大量的文件操作, 比如秒级
        
        生成Segment的段文件, CPU核数太小会影响一定的读写能力, 建议cpu核数在16核+, 不要低于4核

> 副本数

        如果你对es有很强大的健壮性要求, 副本数可以考虑2个以上, 一般一个足矣, 因为过多的副本会消耗足
        
        够的资源.

> 是否需要近实时的响应

        refresh_interval 设置为了1s，可以达到最快1s写入的数据可以被查询到, 但是大部分的业务场景并
        
        不需要这么高的实时性, 所以我们可以根据自己的业务属性来设置refresh_interval

> 能批量就不单条

        利用bulk接口进行批量写入

> 禁用swap

        禁止系统将内存交换到磁盘, 这对于es的性能是致命的

        临时禁用: sudo swapoff -a

        永久禁用: vm.swappiness =1 (/etc/sysctl.conf)

        es配置: bootstrap.memory_lock: true (禁止系统交换内存)

> slow 

        时刻关注easticsearch log当中的慢查询, 尽量避免慢查询的产生.

> shards 大小设置

        每个shards大小设置不大于30G

> mapping设置将_all关闭

        将_all关闭可以提升写入性能
